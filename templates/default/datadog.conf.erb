[Main]
send_to_datadog: <%= node['jahmon-agent']['send_to_datadog'] %>
dd_url: <%= node['jahmon-agent']['dd_url'] %>
api_key: <%= node['jahmon-agent']['api_key'] %>
debug_mode: <%= node['jahmon-agent']['debug'] %>
check_freq: <%= node['jahmon-agent']['check_freq'] %>
hostname: <%= node.name %>
use_mount: <%= node['jahmon-agent']['use_mount'] ? "yes" : "no"  %>
listen_port: <%= node['jahmon-agent']['agent_port'] %>
tags: <%= @setting['tags']%>

dd_url: <%= node['jahmon-agent']['dd_url'] %>
api_key: <%= node['jahmon-agent']['api_key'] %>

<% if !node['jahmon-agent']['dogstreams'].empty? -%>
dogstreams: <%= node['jahmon-agent']['dogstreams'].join(', ') %>
<% end -%>
<% if node['jahmon-agent']['graphite'] -%>
graphite_listen_port: <%= node['jahmon-agent']['graphite_port'] %>
<% end -%>
<% if node['jahmon-agent']['dogstatsd'] -%>
# ========================================================================== #
# DogStatsd configuration                                                    #
# ========================================================================== #
# DogStatsd is a small server that aggregates your custom app metrics. For
# usage information, check out http://docs.datadoghq.com
#  Make sure your client is sending to the same port.
dogstatsd_port : <%= node['jahmon-agent']['dogstatsd_port'] %>

## The dogstatsd flush period.
dogstatsd_interval : <%= node['jahmon-agent']['dogstatsd_interval'] %>
<% end -%>

# ========================================================================== #
# Logging
# ========================================================================== #

log_level: <%= @setting['log_level']%>

collector_log_file: /var/log/jahmon-agent/collector.log
forwarder_log_file: /var/log/jahmon-agent/forwarder.log
# dogstatsd_log_file: /var/log/jahmon-agent/dogstatsd.log

# if syslog is enabled but a host and port are not set, a local domain socket
# connection will be attempted
#
log_to_syslog: <%= node['jahmon-agent']['syslog']['active'] ? 'yes' : 'no' %>
<% if node['jahmon-agent']['syslog']['udp'] -%>
syslog_host: <%= node['jahmon-agent']['syslog']['host'] %>
syslog_port: <%= node['jahmon-agent']['syslog']['port'] %>
<% end -%>

# ========================================================================== #
# Mon-API Configuration
# ========================================================================== #

send_to_mon_api: <%= @setting['send_to_mon_api']%>
mon_api_url: <%= @setting['api']['mon_api_url']%>
mon_api_project_id: <%= @setting['api']['mon_api_project_id'] %>
mon_api_username: <%= @setting['api']['mon_api_username'] %>
mon_api_password: <%= @setting['api']['mon_api_password'] %>
use_keystone: <%= @setting['api']['use_keystone'] %>
keystone_url: <%= @setting['api']['keystone_url'] %>
aggregate_metrics: <%= @setting['api']['aggregate_metrics'] %>
metric_name_map:
  <% @setting['metric_name_map'].each_pair do |dd_name, mon_name| %>
     <%= dd_name %>: <%=mon_name %>
  <% end %>
