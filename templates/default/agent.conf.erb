# ========================================================================== #
# Mon-API Configuration
# ========================================================================== #
[Api]
# Monitoring API URL: URL for the monitoring API
# Example: https://region-a.geo-1.monitoring.hpcloudsvc.com/v1.1/metrics
url: <%= @setting['api']['mon_api_url']%>
# Monitoring API Project Id: Project Id for the monitoring API
project_id: <%= @setting['api']['mon_api_project_id'] %>
# Monitoring API Username: Username for the monitoring API
username: <%= @setting['api']['mon_api_username'] %>
# Monitoring API Password: Password for the monitoring API
password: <%= @setting['api']['mon_api_password'] %>
# Use Keystone for Authentication?: Use Keystone for authentication
# True or False
use_keystone: <%= @setting['api']['use_keystone'] %>
# Keystone API URL: URL for the Keystone server to use
# Example: https://region-a.geo-1.identity.hpcloudsvc.com:35357/v3/auth/tokens
keystone_url: <%= @setting['api']['keystone_url'] %>

# Mapping file for monitoring metrics
mapping_file: <%= node['mon-agent']['mapping_file'] %>


[Main]
debug_mode: <%= node['mon-agent']['debug'] %>
check_freq: <%= node['mon-agent']['check_freq'] %>
hostname: <%= node.name %>
use_mount: <%= node['mon-agent']['use_mount'] ? "yes" : "no"  %>
listen_port: <%= node['mon-agent']['agent_port'] %>

# Optional dimensions to be sent with every metric from this node
# They should be in the format name:value and seperated by a comma
# Example (dimensions: service:nova, group:group_a, ...)
<%
# Dimensions may exist globally in data bags, or per-node in attributes.
# Combine as needed into a single comma-delimited string.
if @setting['dimensions'].to_s != '' and
 node['mon-agent']['dimensions'].to_s != ''
  dimensions = [@setting['dimensions'],
    node['mon-agent']['dimensions']].join(', ')
elsif @setting['dimensions'].to_s != ''
  dimensions = @setting['dimensions']
elsif node['mon-agent']['dimensions'].to_s != ''
  dimensions = node['mon-agent']['dimensions']
end
-%>
dimensions: <%= dimensions -%>

<% if !node['mon-agent']['dogstreams'].empty? -%>
dogstreams: <%= node['mon-agent']['dogstreams'].join(', ') %>
<% end -%>

<% if node['mon-agent']['monstatsd'] -%>
# ========================================================================== #
# MonStatsd configuration                                                    #
# ========================================================================== #
# MonStatsd is a small server that aggregates your custom app metrics.
#  Make sure your client is sending to the same port.
monstatsd_port : <%= node['mon-agent']['monstatsd_port'] %>

## The monstatsd flush period.
monstatsd_interval : <%= node['mon-agent']['monstatsd_interval'] %>

## If 'yes', counters and rates will be normalized to 1 second (that is divided
## by the monstatsd_interval) before being sent to the server. Defaults to 'yes'
monstatsd_normalize : <%= node['mon-agent']['monstatsd_normalize'] %>

# If you want to forward every packet received by the monstatsd server
# to another statsd server, uncomment these lines.
# WARNING: Make sure that forwarded packets are regular statsd packets and not "momonnstatsd" packets,
# as your other statsd server might not be able to handle them.
# statsd_forward_host: address_of_own_statsd_server
# statsd_forward_port: 8125
<% end -%>

# ========================================================================== #
# Logging
# ========================================================================== #

log_level: <%= @setting['log_level']%>

collector_log_file: /var/log/mon-agent/collector.log
forwarder_log_file: /var/log/mon-agent/forwarder.log
monstatsd_log_file: /var/log/mon-agent/monstatsd.log

# if syslog is enabled but a host and port are not set, a local domain socket
# connection will be attempted
#
log_to_syslog: <%= node['mon-agent']['syslog']['active'] ? 'yes' : 'no' %>
<% if node['mon-agent']['syslog']['udp'] -%>
syslog_host: <%= node['mon-agent']['syslog']['host'] %>
syslog_port: <%= node['mon-agent']['syslog']['port'] %>
<% end -%>
disable_file_logging: <%= node['mon-agent']['disable_file_logging'] %>
